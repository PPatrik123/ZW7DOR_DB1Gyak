CREATE DATABASE ZW7DOR;
USE ZW7DOR;
CREATE TABLE GYARTO(adoszam INT PRIMARY KEY, nev CHAR(30) NOT NULL, iranyitoszam CHAR(4), varos char(40), utac char(100));
CREATE TABLE TERMEK(tkod INT PRIMARY KEY, nev CHAR(30) NOT NULL, ear INT CHECK(ear>0), gyarto INT REFERENCES GYARTO);
CREATE TABLE EGYSEGEK(aru INT REFERENCES TERMEK, db INT CHECK(db>0));
CREATE TABLE ALKATRESZ(akod INT PRIMARY KEY, nev CHAR(30) NOT NULL);
CREATE TABLE KOMPONENS(termek INT REFERENCES TERMEK, alkatresz INT REFERENCES ALKATRESZ);

INSERT INTO GYARTO VALUES(00000000, "tesco", 4000, NULL, NULL);
INSERT INTO GYARTO VALUES(11111111, "auchan", 2000, "Miskolc", "Károly utca");
INSERT INTO GYARTO VALUES(22222222, "real", 5300, NULL, NULL);
INSERT INTO GYARTO VALUES(33333333, "coop", 1000, NULL, NULL);

INSERT INTO TERMEK VALUES(0, "egér", 5000, 00000000);
INSERT INTO TERMEK VALUES(1, "kapa", 2000, 11111111);
INSERT INTO TERMEK VALUES(2, "virág", 3000, 00000000);
INSERT INTO TERMEK VALUES(3, "lcd kijelző", 15000, 00000000);
INSERT INTO TERMEK VALUES(4, "kanapé", 10000, 11111111);

INSERT INTO EGYSEGEK VALUES(0, 10);
INSERT INTO EGYSEGEK VALUES(1, 18);
INSERT INTO EGYSEGEK VALUES(2, 34);
INSERT INTO EGYSEGEK VALUES(3, 100);
INSERT INTO EGYSEGEK VALUES(4, 40);

INSERT INTO ALKATRESZ VALUES(00, "LÉZER");
INSERT INTO ALKATRESZ VALUES(01, "NYÉL");
INSERT INTO ALKATRESZ VALUES(02, "VÁZA");
INSERT INTO ALKATRESZ VALUES(03, "PANEL");
INSERT INTO ALKATRESZ VALUES(04, "ANYAG");

INSERT INTO KOMPONENS VALUES(0, 00);
INSERT INTO KOMPONENS VALUES(0, 03);
INSERT INTO KOMPONENS VALUES(3, 00);
INSERT INTO KOMPONENS VALUES(3, 03);
INSERT INTO KOMPONENS VALUES(2, 04);
INSERT INTO KOMPONENS VALUES(1, 01);
INSERT INTO KOMPONENS VALUES(1, 02);
INSERT INTO KOMPONENS VALUES(4, 04);

ALTER TABLE ALKATRESZ ADD(ar INT, CHECK(ar>0));
SELECT * FROM ALKATRESZ;
SELECT nev FROM gyarto WHERE adoszam NOT IN (SELECT gyarto FROM termek);
UPDATE termek SET ear = 1.1*ear WHERE tkod IN (SELECT termek FROM komponens WHERE alkatresz = (SELECT akod FROM alkatresz WHERE nev = "X"));
CREATE VIEW et AS SELECT MAX(t.nev) nev, t.tkod, COUNT(*) db FROM termek t INNER JOIN egysegek e ON e.aru = t.tkod GROUP BY t.tkod;
SELECT nev FROM et WHERE db = (SELECT MAX(db) FROM et);